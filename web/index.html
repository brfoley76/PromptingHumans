<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Module - Pirate Vocabulary</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/chat-widget.css">
    <link rel="stylesheet" href="css/activity-chat-widget.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <h1>Pirate Vocabulary Adventure</h1>
            <p class="subtitle">3rd Grade Reading Exercise</p>
            <div id="userInfo" class="user-info" style="display: none;">
                <span class="user-name">Welcome, <strong id="userName"></strong></span>
                <span class="student-id">ID: <span id="studentId"></span></span>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Registration Screen -->
            <div id="registrationScreen" class="screen">
                <div class="registration-card">
                    <h2>Welcome to the Learning Module!</h2>
                    <p>Let's get started by telling us your name.</p>
                    
                    <div class="registration-form">
                        <label for="studentName">What's your name?</label>
                        <input type="text" id="studentName" placeholder="Enter your name" maxlength="50">
                        <button id="registerBtn" class="btn btn-primary" disabled>Start Learning</button>
                    </div>
                </div>
            </div>

            <!-- Exercise Selection Screen -->
            <div id="selectionScreen" class="screen">
                <h2 class="section-title">Choose Your Exercise</h2>
                <div class="exercise-grid">
                    <!-- Multiple Choice Card -->
                    <div class="exercise-card" data-exercise="multiple_choice">
                        <div class="exercise-header">
                            <h3>Multiple Choice</h3>
                            <span class="difficulty-badge easy">Easy</span>
                        </div>
                        <p class="exercise-description">Match definitions with the correct vocabulary words.</p>
                        <div class="exercise-scores"></div>
                        <button class="btn btn-exercise" data-exercise-btn="multiple_choice">Play</button>
                    </div>

                    <!-- Fill in the Blank Card -->
                    <div class="exercise-card" data-exercise="fill_in_the_blank">
                        <div class="exercise-header">
                            <h3>Fill in the Blank</h3>
                            <span class="difficulty-badge easy">Easy</span>
                        </div>
                        <p class="exercise-description">Drag words to complete the definitions.</p>
                        <div class="exercise-scores"></div>
                        <button class="btn btn-exercise" data-exercise-btn="fill_in_the_blank">Play</button>
                    </div>

                    <!-- Spelling Card -->
                    <div class="exercise-card locked" data-exercise="spelling">
                        <div class="exercise-header">
                            <h3>Spelling</h3>
                            <span class="difficulty-badge medium">Medium</span>
                        </div>
                        <p class="exercise-description">Type the correct spelling of vocabulary words.</p>
                        <div class="exercise-scores"></div>
                        <div class="lock-overlay">
                            <span class="lock-icon">ðŸ”’</span>
                            <p>Score 80%+ on Fill-in-Blank (Moderate) to unlock</p>
                        </div>
                        <button class="btn btn-exercise" data-exercise-btn="spelling" disabled>Locked</button>
                    </div>

                    <!-- Bubble Pop Card -->
                    <div class="exercise-card locked" data-exercise="bubble_pop">
                        <div class="exercise-header">
                            <h3>Bubble Pop</h3>
                            <span class="difficulty-badge hard">Hard</span>
                        </div>
                        <p class="exercise-description">Click on bubbles with correct or incorrect spelling.</p>
                        <div class="exercise-scores"></div>
                        <div class="lock-overlay">
                            <span class="lock-icon">ðŸ”’</span>
                            <p>Score 80%+ on Spelling (Hard) to unlock</p>
                        </div>
                        <button class="btn btn-exercise" data-exercise-btn="bubble_pop" disabled>Locked</button>
                    </div>

                    <!-- Fluent Reading Card -->
                    <div class="exercise-card locked" data-exercise="fluent_reading">
                        <div class="exercise-header">
                            <h3>Fluent Reading</h3>
                            <span class="difficulty-badge hard">Hard</span>
                        </div>
                        <p class="exercise-description">Practice reading fluency with streaming text display.</p>
                        <div class="exercise-scores"></div>
                        <div class="lock-overlay">
                            <span class="lock-icon">ðŸ”’</span>
                            <p>Score 80%+ on Bubble Pop (Hard) to unlock</p>
                        </div>
                        <button class="btn btn-exercise" data-exercise-btn="fluent_reading" disabled>Locked</button>
                    </div>

                    <!-- More exercises can be added here -->
                </div>
            </div>

            <!-- Multiple Choice Exercise Screen -->
            <div id="multipleChoiceScreen" class="screen">
                <!-- Exercise Settings -->
                <div id="mcSettingsPanel" class="settings-panel">
                    <h2>Multiple Choice Exercise</h2>
                    <div class="settings">
                        <label for="mcNumQuestions">Number of Questions:</label>
                        <select id="mcNumQuestions">
                            <option value="5">5 Questions</option>
                            <option value="10" selected>10 Questions</option>
                            <option value="15">15 Questions</option>
                            <option value="20">20 Questions</option>
                        </select>
                        
                        <label for="mcDifficulty">Difficulty:</label>
                        <select id="mcDifficulty">
                            <option value="3">Easy (3 choices)</option>
                            <option value="4" selected>Medium (4 choices)</option>
                            <option value="5">Hard (5 choices)</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="mcBackBtn" class="btn btn-secondary">Back to Menu</button>
                        <button id="mcStartBtn" class="btn btn-primary">Start Exercise</button>
                    </div>
                </div>

                <!-- Exercise Content -->
                <div id="mcExercisePanel" class="exercise-panel" style="display: none;">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>Question <span id="mcCurrentQuestion">1</span> of <span id="mcTotalQuestions">10</span></span>
                            <span>Score: <span id="mcScore">0</span></span>
                        </div>
                        <div class="progress-bar">
                            <div id="mcProgressFill" class="progress-fill"></div>
                        </div>
                    </div>

                    <!-- Question Card -->
                    <div class="question-card">
                        <h2 class="question-text" id="mcQuestionText">
                            <!-- Question will be inserted here -->
                        </h2>
                        
                        <div id="mcAnswerOptions" class="answer-options">
                            <!-- Radio button options will be inserted here -->
                        </div>
                        
                        <div class="button-group">
                            <button id="mcSubmitBtn" class="btn btn-primary" disabled>Submit Answer</button>
                            <button id="mcNextBtn" class="btn btn-secondary" style="display: none;">Next Question</button>
                        </div>
                        
                        <div id="mcFeedback" class="feedback" style="display: none;">
                            <!-- Feedback will be shown here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fill in the Blank Exercise Screen -->
            <div id="fillInBlankScreen" class="screen">
                <!-- Exercise Settings -->
                <div id="fibSettingsPanel" class="settings-panel">
                    <h2>Fill in the Blank Exercise</h2>
                    <div class="settings">
                        <label for="fibNumQuestions">Number of Questions:</label>
                        <select id="fibNumQuestions">
                            <option value="5">5 Questions</option>
                            <option value="10" selected>10 Questions</option>
                            <option value="15">15 Questions</option>
                        </select>
                        
                        <label for="fibDifficulty">Difficulty:</label>
                        <select id="fibDifficulty">
                            <option value="easy">Easy (Only needed words)</option>
                            <option value="moderate">Moderate (All vocabulary)</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="fibBackBtn" class="btn btn-secondary">Back to Menu</button>
                        <button id="fibStartBtn" class="btn btn-primary">Start Exercise</button>
                    </div>
                </div>

                <!-- Exercise Content -->
                <div id="fibExercisePanel" class="exercise-panel" style="display: none;">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>Filled: <span id="fibFilled">0</span> of <span id="fibTotal">10</span></span>
                            <span>Progress: <span id="fibProgress">0</span>%</span>
                        </div>
                        <div class="progress-bar">
                            <div id="fibProgressFill" class="progress-fill"></div>
                        </div>
                    </div>

                    <!-- Word Bank -->
                    <div class="word-bank-container">
                        <h3>Word Bank</h3>
                        <div id="wordBank" class="word-bank">
                            <!-- Draggable words will be inserted here -->
                        </div>
                    </div>

                    <!-- Questions -->
                    <div id="fibQuestions" class="fib-questions">
                        <!-- Fill in the blank questions will be inserted here -->
                    </div>

                    <!-- Submit Button -->
                    <div class="button-group">
                        <button id="fibCheckBtn" class="btn btn-primary" disabled>Check Answers</button>
                    </div>
                </div>
            </div>

            <!-- Spelling Exercise Screen -->
            <div id="spellingScreen" class="screen">
                <!-- Exercise Settings -->
                <div id="spSettingsPanel" class="settings-panel">
                    <h2>Spelling Exercise</h2>
                    <div class="settings">
                        <label for="spNumQuestions">Number of Questions:</label>
                        <select id="spNumQuestions">
                            <option value="5">5 Questions</option>
                            <option value="10" selected>10 Questions</option>
                            <option value="15">15 Questions</option>
                            <option value="20">20 Questions</option>
                        </select>
                        
                        <label for="spDifficulty">Difficulty:</label>
                        <select id="spDifficulty">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button id="spBackBtn" class="btn btn-secondary">Back to Menu</button>
                        <button id="spStartBtn" class="btn btn-primary">Start Exercise</button>
                    </div>
                </div>

                <!-- Exercise Content -->
                <div id="spExercisePanel" class="exercise-panel" style="display: none;">
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>Question <span id="spCurrentQuestion">1</span> of <span id="spTotalQuestions">10</span></span>
                            <span>Score: <span id="spScore">0</span></span>
                        </div>
                        <div class="progress-bar">
                            <div id="spProgressFill" class="progress-fill"></div>
                        </div>
                    </div>

                    <!-- Question Card -->
                    <div class="question-card">
                        <h2 class="question-text" id="spQuestionText">
                            <!-- Definition will be inserted here -->
                        </h2>
                        
                        <div class="spelling-input-container">
                            <input type="text" id="spAnswerInput" class="spelling-input" placeholder="Type your answer here" autocomplete="off">
                            <div id="spInputFeedback" class="input-feedback"></div>
                        </div>
                        
                        <div class="button-group">
                            <button id="spSubmitBtn" class="btn btn-primary">Submit Answer</button>
                            <button id="spNextBtn" class="btn btn-secondary" style="display: none;">Next Question</button>
                        </div>
                        
                        <div id="spFeedback" class="feedback" style="display: none;">
                            <!-- Feedback will be shown here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bubble Pop Game Screen -->
            <div id="bubblePopScreen" class="screen">
                <!-- Exercise Settings -->
                <div id="bpSettingsPanel" class="settings-panel">
                    <h2>Bubble Pop Game</h2>
                    <div class="settings">
                        <label for="bpDuration">Duration:</label>
                        <select id="bpDuration">
                            <option value="60">1 minute</option>
                            <option value="120">2 minutes</option>
                            <option value="180">3 minutes</option>
                        </select>
                        
                        <label for="bpDifficulty">Difficulty:</label>
                        <select id="bpDifficulty">
                            <option value="easy">Easy - Press Q for correct words</option>
                            <option value="moderate">Moderate - Press R for incorrect words</option>
                            <option value="hard">Hard - Use Q and R for both types</option>
                        </select>
                        
                        <label for="bpErrorRate">Spelling Error Rate: <span id="bpErrorRateValue">30%</span></label>
                        <input type="range" id="bpErrorRate" min="10" max="50" value="30"
                               oninput="document.getElementById('bpErrorRateValue').textContent = this.value + '%'">
                    </div>
                    
                    <div class="difficulty-info" style="margin: 20px 0; padding: 15px; background: #f8fbff; border-radius: 8px;">
                        <h4 style="color: #003366; margin-bottom: 10px;">Difficulty Details:</h4>
                        <ul style="color: #004080; font-size: 0.9em; list-style: none; padding: 0;">
                            <li><strong>Easy:</strong> Slower speed (30%), use Q key only for correct words</li>
                            <li><strong>Moderate:</strong> Medium speed (50%), use R key only for incorrect words</li>
                            <li><strong>Hard:</strong> Faster speed (70%), use both Q and R keys</li>
                        </ul>
                        <p style="color: #666; font-size: 0.85em; margin-top: 10px;">Speed and spawn rate increase 15% over time in all modes.</p>
                    </div>
                    <div class="button-group">
                        <button id="bpBackBtn" class="btn btn-secondary">Back to Menu</button>
                        <button id="bpInstructionsBtn" class="btn btn-info">Instructions</button>
                        <button id="bpStartBtn" class="btn btn-primary">Start Game</button>
                    </div>
                </div>

                <!-- Game Panel -->
                <div id="bpGamePanel" class="game-panel" style="display: none;">
                    <!-- Game Header -->
                    <div class="game-header">
                        <div class="game-stats">
                            <div class="stat-item">
                                <span class="stat-label">Time:</span>
                                <span id="bpTimeRemaining" class="stat-value">1:00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Right:</span>
                                <span id="bpScoreRight" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Wrong:</span>
                                <span id="bpScoreWrong" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Missed:</span>
                                <span id="bpScoreMissed" class="stat-value">0</span>
                            </div>
                        </div>
                        <button id="bpQuitBtn" class="btn btn-danger btn-small">Quit Game</button>
                    </div>
                    
                    <!-- Game Canvas -->
                    <div class="canvas-container">
                        <canvas id="bpCanvas" width="900" height="600"></canvas>
                    </div>
                    
                    <!-- Game Controls Info -->
                    <div class="game-controls">
                        <p><strong>Controls:</strong> Hover over bubble + Q = Correct Spelling | Hover + R = Incorrect Spelling | ESC = Pause</p>
                    </div>
                </div>

                <!-- Instructions Overlay -->
                <div id="bpInstructionsOverlay" class="overlay" style="display: none;">
                    <div class="overlay-content">
                        <h2>How to Play Bubble Pop</h2>
                        <div class="instructions">
                            <p><strong>Objective:</strong> Identify whether words are spelled correctly or incorrectly as they float across the screen.</p>
                            
                            <h3>Controls:</h3>
                            <ul>
                                <li><strong>Hover over bubble + Q:</strong> Mark as correctly spelled</li>
                                <li><strong>Hover over bubble + R:</strong> Mark as incorrectly spelled</li>
                                <li><strong>ESC:</strong> Pause the game</li>
                            </ul>
                            
                            <h3>Difficulty Modes:</h3>
                            <ul>
                                <li><strong>Easy:</strong> Press Q to identify correctly spelled words. Q on misspelled words counts as a mistake. Unclicked misspelled words count as correct.</li>
                                <li><strong>Moderate:</strong> Press R to identify incorrectly spelled words. R on correct words counts as a mistake. Unclicked correct words count as correct.</li>
                                <li><strong>Hard:</strong> Use both Q (correct) and R (incorrect) to identify all words appropriately.</li>
                            </ul>
                            
                            <h3>Scoring:</h3>
                            <ul>
                                <li><strong>Right:</strong> You correctly identified the spelling</li>
                                <li><strong>Wrong:</strong> You incorrectly identified the spelling</li>
                                <li><strong>Missed:</strong> The bubble left the screen without being clicked</li>
                            </ul>
                            
                            <h3>Difficulty:</h3>
                            <ul>
                                <li><strong>Speed:</strong> How fast bubbles move (0-100)</li>
                                <li><strong>Movement:</strong> How much bubbles move up and down (0-100)</li>
                                <li><strong>Spelling Errors:</strong> Percentage of words with errors (0-100%)</li>
                            </ul>
                            
                            <p><strong>Tip:</strong> The game gets progressively harder every 3 minutes!</p>
                        </div>
                        <button id="bpCloseInstructions" class="btn btn-primary">Got it!</button>
                    </div>
                </div>

                <!-- Pause Overlay -->
                <div id="bpPauseOverlay" class="overlay" style="display: none;">
                    <div class="overlay-content">
                        <h2>Game Paused</h2>
                        <p>Press ESC to resume</p>
                    </div>
                </div>
            </div>


            <!-- Fluent Reading Screen -->
            <div id="fluentReadingScreen" class="screen">
                <!-- Exercise Settings -->
                <div id="frSettingsPanel" class="settings-panel">
                    <h2>Fluent Reading Exercise</h2>
                    <div class="settings">
                        <label for="frDifficulty">Difficulty:</label>
                        <select id="frDifficulty">
                            <option value="easy">Easy - Vocabulary focus (67% speed, 2x time)</option>
                            <option value="moderate" selected>Moderate - Spelling focus (85% speed, 1.5x time)</option>
                            <option value="hard">Hard - All variants (100% speed, 1.3x time)</option>
                        </select>
                        
                        <label for="frSpeed">Reading Speed: <span id="frSpeedValue">150 WPM</span></label>
                        <input type="range" id="frSpeed" min="50" max="300" value="150" step="10">
                        
                        <div id="frTimeEstimate" class="time-estimate" style="margin: 15px 0; padding: 10px; background: #f8fbff; border-radius: 5px; color: #004080;">
                            Estimated reading time: 2 minutes (Timer: 4 minutes)
                        </div>
                        
                        <div class="instructions" style="margin: 20px 0; padding: 15px; background: #f8fbff; border-radius: 8px;">
                            <h4 style="color: #003366; margin-bottom: 10px;">How to Use:</h4>
                            <ul style="color: #004080; font-size: 0.9em; list-style: none; padding: 0;">
                                <li>â€¢ Text will stream from right to left in the bottom zone</li>
                                <li>â€¢ As words exit left, they appear in the reading zone above</li>
                                <li>â€¢ Click any word to highlight its entire fragment in yellow</li>
                                <li>â€¢ Press ESC to pause/resume at any time</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button id="frBackBtn" class="btn btn-secondary">Back to Menu</button>
                        <button id="frStartBtn" class="btn btn-primary">Start Reading</button>
                    </div>
                </div>

                <!-- Game Panel -->
                <div id="frGamePanel" class="game-panel" style="display: none;">
                    <!-- Game Canvas (contains all three zones) -->
                    <div class="canvas-container">
                        <canvas id="frCanvas" width="900" height="600"></canvas>
                    </div>
                    
                    <!-- Game Controls Info -->
                    <div class="game-controls">
                        <p><strong>Controls:</strong> Click words to highlight fragments | ESC = Pause/Resume</p>
                    </div>
                    
                    <button id="frQuitBtn" class="btn btn-danger btn-small">Quit Reading</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen">
                <div class="results-card">
                    <h2 id="resultsTitle">Great Job! ðŸŽ‰</h2>
                    <div class="results-content">
                        <div class="score-display">
                            <p class="final-score">Your Score: <span id="finalScore">0</span> / <span id="finalTotal">10</span></p>
                            <p class="percentage" id="percentage">0%</p>
                        </div>
                        
                        <div class="results-message" id="resultsMessage">
                            <!-- Encouraging message will be inserted here -->
                        </div>
                        
                        <div class="results-summary">
                            <h3>Summary</h3>
                            <ul id="resultsSummary">
                                <!-- Summary of answers will be inserted here -->
                            </ul>
                        </div>
                        
                        <div class="button-group">
                            <button id="menuBtn" class="btn btn-secondary">Back to Menu</button>
                            <button id="retryBtn" class="btn btn-primary">Try Again</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Learning Module - Educational Platform</p>
        </footer>
    </div>

    <!-- JavaScript Files -->
    <!-- Core Framework -->
    <script src="js/core/ExerciseFramework.js"></script>
    
    <!-- Utilities -->
    <script src="js/utils/ErrorHandler.js"></script>
    
    <!-- Shared Components -->
    <script src="js/components/CanvasRenderer.js"></script>
    <script src="js/components/InputHandler.js"></script>
    
    <!-- Backend Integration -->
    <script src="js/integration/APIClient.js"></script>
    <script src="js/integration/SessionManager.js"></script>
    <script src="js/integration/WebSocketClient.js"></script>
    <script src="js/integration/ChatWidget.js"></script>
    <script src="js/integration/ActivityChatWidget.js"></script>
    
    <!-- Core Modules -->
    <script src="js/curriculum.js"></script>
    <script src="js/scoreManager.js"></script>
    
    <!-- Legacy Exercises (to be migrated) -->
    <script src="js/fillInBlank.js"></script>
    <script src="js/spellingExercise.js"></script>
    
    <!-- Modular Exercises -->
    <!-- Multiple Choice -->
    <script src="js/exercises/multipleChoice/MultipleChoiceExercise.js"></script>
    <script src="js/exercises/multipleChoice/MultipleChoiceUI.js"></script>
    
    <!-- Bubble Pop -->
    <script src="js/exercises/bubblePop/BubblePopExercise.js"></script>
    <script src="js/exercises/bubblePop/BubblePopUI.js"></script>
    
    <!-- Fluent Reading -->
    <script src="js/exercises/fluentReading/FluentReadingExercise.js"></script>
    <script src="js/exercises/fluentReading/FluentReadingUI.js"></script>
    
    <!-- Main App -->
    <script src="js/app.js"></script>
</body>
</html>
